angular.module("hbp-common-templates",["templates/breadcrumb.html","templates/content-description.html","templates/content-icon.html","templates/dialog-alert.html","templates/dialog-confirmation.html","templates/error-alert.html","templates/error-message.html","templates/icon.html","templates/userSelector.html","templates/usercard.html"]),angular.module("templates/breadcrumb.html",[]).run(["$templateCache",function(a){a.put("templates/breadcrumb.html",'<ol class="breadcrumb">\n    <li ng-repeat="item in parentItems"\n        ><a ng-href="{{urlForState(item.state, item.stateParams)}}"\n            ><hbp-icon type="item.type"></hbp-icon>\n            <span class="breadcrumb-item-name {{item.class}}">{{item.name}}</span\n        ></a\n    ></li\n    ><li\n        ><hbp-icon type="currentItem.type"></hbp-icon>\n        <span class="breadcrumb-item-name {{currentItem.class}}">{{currentItem.name}}</span\n    ></li>\n</ol>\n')}]),angular.module("templates/content-description.html",[]).run(["$templateCache",function(a){a.put("templates/content-description.html",'<span ng-switch="content">\n    <span ng-switch-when="application/vnd.bbp.FeatureExtract.Dependency+txt">Text FeatureExtract</span>\n    <span ng-switch-when="application/vnd.bbp.SimulationProtocol.StimulationConfig">Simulation Configuration</span>\n    <span ng-switch-when="application/vnd.bbp.SimulationProtocol.ReportingConfig">Reporting Configuration</span>\n    <span ng-switch-when="application/vnd.bbp.Circuit.Config+config">Circuit Configuration</span>\n    <span ng-switch-when="application/vnd.bbp.Circuit.Config">Circuit Configuration</span>\n    <span ng-switch-when="application/vnd.bbp.Circuit.Combination">Circuit Combination</span>\n    <span ng-switch-when="application/vnd.bbp.Circuit.Combination+xml">XML Circuit Combination</span>\n    <span ng-switch-when="application/vnd.bbp.Simulation.BlueConfig">BlueConfig File</span>\n    <span ng-switch-when="application/vnd.bbp.Simulation.HOC">HOC Simulation</span>\n    <span ng-switch-when="application/vnd.bbp.bundle.Image.png">Image Bundle</span>\n    <span ng-switch-when="application/zip">Archive</span>\n    <span ng-switch-when="application/rar">Archive</span>\n    <span ng-switch-when="application/json">JSON</span>\n    <span ng-switch-when="application/txt">Plain Text</span>\n    <span ng-switch-when="text/plain">Plain Text</span>\n    <span ng-switch-when="image/jpeg">JPEG Image</span>\n    <span ng-switch-when="image/png">PNG Image</span>\n    <span ng-switch-when="image/gif">GIF Image</span>\n    <span ng-switch-when="video/avi">AVI Video</span>\n    <span ng-switch-when="video/mpg">MPEG Video</span>\n    <span ng-switch-when="model/vnd.bbp.Morphology.Morphology">Morphology</span>\n    <span ng-switch-when="model/vnd.bbp.Morphology.Morphology+asc">ASCI Morphology</span>\n    <span ng-switch-when="model/vnd.bbp.Morphology.Morphology+h5">H5 Morphology</span>\n    <span ng-switch-when="model/vnd.bbp.Morphology.NeuronDB">DAT NeuronDB</span>\n    <span ng-switch-when="model/vnd.bbp.Morphology.NeuronDB+dat">DAT NeuronDB</span>\n    <span ng-switch-default>{{fallback}}</span>\n</span>\n')}]),angular.module("templates/content-icon.html",[]).run(["$templateCache",function(a){a.put("templates/content-icon.html",'<span class="bbp-browser-entity-icon" ng-switch="content">\n    <i ng-switch-when="application/zip" class="fa fa-file-archive-o"></i>\n    <i ng-switch-when="application/rar" class="fa fa-file-archive-o"></i>\n    <i ng-switch-when="application/txt" class="fa fa-file-text-o"></i>\n    <i ng-switch-when="text/plain" class="fa fa-file-text-o"></i>\n    <i ng-switch-when="application/pdf" class="fa fa-file-pdf-o"></i>\n    <i ng-switch-when="image/jpeg" class="fa fa-file-image-o"></i>\n    <i ng-switch-when="image/png" class="fa fa-file-image-o"></i>\n    <i ng-switch-when="image/gif" class="fa fa-file-image-o"></i>\n    <i ng-switch-when="application/json" class="fa fa-file-code-o"></i>\n    <i ng-switch-when="video/avi" class="fa fa-file-video-o"></i>\n    <i ng-switch-when="video/mpeg" class="fa fa-file-video-o"></i>\n    <i ng-switch-default class="fa fa-file-o"></i>\n</span>\n')}]),angular.module("templates/dialog-alert.html",[]).run(["$templateCache",function(a){a.put("templates/dialog-alert.html",'<div class="modal-header"  >\n    <button type="button" class="close" ng-click="$close()" aria-hidden="true">&times;</button>\n    <h4 class="modal-title">{{title}}</h4>\n</div>\n<div class="modal-body {{htmlClass}}">\n    <ng-include src="alertContentUrl"></ng-include>\n    {{alertContent}}\n</div>\n<div class="modal-footer">\n    <button class="btn btn-default" ng-click="$close()">{{label}}</button>\n</div>\n')}]),angular.module("templates/dialog-confirmation.html",[]).run(["$templateCache",function(a){a.put("templates/dialog-confirmation.html",'<div class="modal-header"  >\n    <button type="button" ng-show="closable" class="close" ng-click="$dismiss(\'cancel\')" aria-hidden="true">&times;</button>\n    <h4 class="modal-title">{{title}}</h4>\n</div>\n<div class="modal-body">\n    <alert ng-if="error" type="danger">{{error.reason}}</alert>\n    <div class="alert alert-warning" ng-show="securityQuestion">Unexpected bad things will happen if you donâ€™t read this!</div>\n\n    <ng-include ng-if="confirmationContentUrl" src="confirmationContentUrl"></ng-include>\n    <p ng-if="!confirmationContentUrl">{{confirmationContent}}</p>\n\n    <fieldset class="form-group" ng-show="securityQuestion">\n        <label for="securityAnswer">{{securityQuestion}}</label>\n        <input type="text" class="form-control" name="securityAnswer" ng-model="answer">\n    </fieldset>\n</div>\n<div class="modal-footer">\n    <button class="btn btn-default" ng-click="$dismiss(\'cancel\')">{{cancelLabel}}</button>\n    <button class="btn btn-danger" ng-disabled="securityAnswer && answer !== securityAnswer" ng-click="$close()">{{confirmLabel}}</button>\n</div>\n')}]),angular.module("templates/error-alert.html",[]).run(["$templateCache",function(a){a.put("templates/error-alert.html",'<div class="alert alert-danger">[{{error.type}}] {{error.message}}</div>\n<pre><code>{{error | json}}</code></pre>\n')}]),angular.module("templates/error-message.html",[]).run(["$templateCache",function(a){a.put("templates/error-message.html",'<alert type="danger" ng-if="error">\n    <div ng-switch on="error.type">\n        <div ng-switch-when="Validation">\n                Validation errors<span ng-show="error.data">:</span>\n            <ul>\n            <li ng-repeat="(attr, errors) in error.data">{{attr}}: {{errors.join(\', \')}}</li>\n        </ul>\n        </div>\n        <div ng-switch-default>\n            {{error.message}}\n        </div>\n    </div>\n</alert>')}]),angular.module("templates/icon.html",[]).run(["$templateCache",function(a){a.put("templates/icon.html",'<span class="bbp-browser-entity-icon" ng-switch="type">\n    <i ng-switch-when="root" class="glyphicon glyphicon-home"></i>\n    <i ng-switch-when="project" class="glyphicon glyphicon-hdd"></i>\n    <i ng-switch-when="folder" class="glyphicon glyphicon-folder-open"></i>\n    <i ng-switch-when="file" class="glyphicon glyphicon-file"></i>\n    <i ng-switch-when="release" class="glyphicon glyphicon-lock"></i>\n    <i ng-switch-when="link:folder" class="glyphicon glyphicon-link"></i>\n    <i ng-switch-when="link:file" class="glyphicon glyphicon-link"></i>\n    <i ng-switch-when="link:project" class="glyphicon glyphicon-link"></i>\n    <i ng-switch-when="link:release" class="glyphicon glyphicon-link"></i>\n</span>\n')}]),angular.module("templates/userSelector.html",[]).run(["$templateCache",function(a){a.put("templates/userSelector.html",'<div class="input-group hbp-user-selector" ng-class="{\'has-error\': false}">\n    <input class="form-control" ng-model="newUser" type="text" placeholder="type user name"\n      typeahead="user as user.displayName for user in getUsers($viewValue)"\n      typeahead-editable="false"\n      typeahead-on-select="selectUser()"\n      typeahead-min-length="3"\n      typeahead-wait-ms="300"\n      ng-keypress="noSubmitOnEnter($event)"\n      name="new-user"\n      ng-disabled="selectionDisabled">\n    <span class="input-group-btn">\n      <button ng-click="selectUser()" class="btn btn-default" type="button"><i class="glyphicon glyphicon-plus"></i></button>\n    </span>\n</div>\n')}]),angular.module("templates/usercard.html",[]).run(["$templateCache",function(a){a.put("templates/usercard.html",'<div ng-if="user" class="hbp-usercard hbp-card hbp-card-default">\n    <h3 class="hbp-usercard-name">\n        {{user.displayName}}\n    </h3>\n    <div class="hbp-usercard-pix">\n        <img ng-src="{{user.picture}}" ng-if="user.picture" />\n        <hbp-generated-icon hbp-text="user.displayName" ng-if="!user.picture"></hbp-generated-icon>\n    </div>\n    <div class="hbp-usercard-institution" ng-if="institution">\n        <span class="hbp-usercard-institution-title">{{institution.title}}</span>,\n        <span class="hbp-usercard-institution-name">{{institution.name}}</span>,\n        <span class="hbp-usercard-institution-dept">{{institution.department}}</span>\n    </div>\n    <div class="hbp-usercard-contact">\n        <a class="hbp-usercard-contact-item hbp-usercard-email" target="_top" href="mailto:{{email}}" ng-if="email"><span class="glyphicon glyphicon-envelope"></span> {{email}}</a>\n        <span class="hbp-usercard-contact-item hbp-usercard-phone" ng-if="phone"><span class="glyphicon glyphicon-phone"></span> {{phone}}</span>\n        <span class="hbp-usercard-contact-item hbp-usercard-im-list" ng-if="ims.length"><span class="glyphicon glyphicon-bullhorn"></span>\n            <span class="hbp-usercard-im" ng-repeat="im in ims">\n                {{im.value}}({{im.type}})\n            </span>\n        </span>\n    </div>\n</div>\n')}]),function(){"use strict";function a(a,b,c){function d(b){return a.reject(c.httpError(b))}function e(a,b){return new f(a,b).promise}function f(d,e){function f(){return s.hasNext?b.get(s.nextUrl).then(k):a.reject(j)}function g(){return s.hasPrevious?b.get(s.previousUrl).then(l):a.reject(j)}function h(){return s.hasNext?f().then(h):s.results.slice()}function k(b){var c,d=b.data,f=i(d,e.resultKey);return e.resultsFactory&&(c=e.resultsFactory(f)),a.when(c).then(function(a){return s.results.push.apply(s.results,a||f),p(d),n(d),s})}function l(b){var c,d=b.data,f=i(d,e.resultKey);return e.resultsFactory&&(c=e.resultsFactory(f)),a.when(c).then(function(a){return s.results.unshift.apply(s.results,a||f),p(d),o(d),s})}function m(b){return s.error=c.httpError(b),angular.isFunction(e.errorHandler)&&e.errorHandler(s.error),a.reject(s.error)}function n(a){s.nextUrl=i(a,e.nextUrlKey),s.hasNext=!!s.nextUrl}function o(a){s.previousUrl=i(a,e.previousUrlKey),s.hasPrevious=!!s.previousUrl}function p(a){var b=i(a,e.countKey);angular.isDefined(b)&&(s.count=b)}function q(b){return function(){return s.promise=a.when(s.promise.then(b))["catch"](m),s.promise.instance=s,s.promise}}function r(a){return k(a).then(function(){return o(a.data),s})}var s=this;s.results=[],s.error=null,s.hasNext=null,s.hasPrevious=null,s.promise=null,s.errorHandler=null,s.next=q(f),s.previous=q(g),s.toArray=q(h),s.count=-1,e=angular.extend({resultKey:"results",nextUrlKey:"next",previousUrlKey:"previous",countKey:"count"},e),s.promise=a.when(d).then(r)["catch"](m),s.promise.instance=s}function g(a,b){return angular.isArray(b)||(b=[b]),a.replace(/{(\d+)}/g,function(a,c){return"undefined"!=typeof b[c]?b[c]:a})}function h(a){return _.isArray(a)?a:[a]}function i(a,b){for(var c=b.split(".");c.length&&a;)a=a[c.shift()];return a}var j=c.error({type:"ResultSet::EOL",message:"End of list reached"}),k={format:g,paginatedResultSet:e,ferr:d,ResultSetEOL:j,arrayOf:h};return k}angular.module("hbpUtil",[]).factory("hbpUtil",a),a.$inject=["$q","$http","hbpErrorService"]}(),angular.module("hbpIdentity",["hbpUtil","bbpConfig"]),function(){"use strict";function a(a,b,c,d,e,f,g,h){function i(a,b){return{nextUrlKey:"_links.next.href",previousUrlKey:"_links.prev.href",resultKey:"_embedded."+a+"s",countKey:"page.totalElements",resultsFactory:b}}function j(a){return c.get(D()+"/"+a).then(function(a){return a.data},g.ferr)}function k(a,b){var d=function(a){return g.paginatedResultSet(c.get(D()+"/"+a+"/members"))},e=function(a,b){return b=angular.extend({},b),g.paginatedResultSet(c.get(D()+"/"+a+"/members",{params:h.queryParamsV1(b)}),i("user",b.factory))};return[d,e][h.userApiVersion()](a,b)}function l(a,b){return b=angular.extend({},b),g.paginatedResultSet(c.get(D()+"/"+a+"/epfl-synced-members",{params:h.queryParamsV1()}),i("user",b.factory))}function m(a,b){return b=angular.extend({},b),g.paginatedResultSet(c.get(D()+"/"+a+"/member-groups",{params:h.queryParamsV1(b)}),i("group",b.factory))}function n(a,b){return b=angular.extend({},b),g.paginatedResultSet(c.get(D()+"/"+a+"/admins",{params:h.queryParamsV1(b)}),i("user",b.factory))}function o(a,b){return b=angular.extend({},b),g.paginatedResultSet(c.get(D()+"/"+a+"/admin-groups",{params:h.queryParamsV1(b)}),i("group",b.factory))}function p(a,b){return b=angular.extend({},b),g.paginatedResultSet(c.get(D()+"/"+a+"/parent-groups",{params:h.queryParamsV1()}),i("group",b.factory))}function q(a,b){return b=angular.extend({},b),g.paginatedResultSet(c.get(D()+"/"+a+"/managed-groups",{params:h.queryParamsV1(b)}),i("group",b.factory))}function r(a,d){return e.get("collab.features.identity.userApiV1",!1)?c.post(D(),{name:a,description:d}).then(function(a){return a.data})["catch"](g.ferr):b.reject(C())}function s(a){return e.get("collab.features.identity.userApiV1",!1)?c.patch(D()+"/"+a.name,{description:a.description}).then(function(b){return angular.extend(a,b.data)})["catch"](g.ferr):b.reject(C())}function t(a){return e.get("collab.features.identity.userApiV1",!1)?c["delete"](D()+"/"+a).then(function(){})["catch"](function(a){return b.reject(f.httpError(a))}):b.reject(C())}function u(a){var b={addMembers:v,removeMembers:w};if(!b[a])throw f.error({type:"UnsupportedMethodException",message:"HBP Identity API must be v1 or higher to use method "+a});return b[a]}function v(a,b){var d={users:g.arrayOf(b)};return g.paginatedResultSet(c.put(D()+"/"+a+"/members",d))}function w(a,b){var d={users:b};return g.paginatedResultSet(c({method:"DELETE",url:D()+"/"+a+"/members",data:d,headers:{"Content-Type":"application/json"}}))}function x(a){var c=E.get(a);return c?b.when(c):y({filter:{name:a}}).then(function(c){return 1===c.results.length?(E.put(a,c.results[0]),c.results[0]):0===c.results.length?void 0:b.reject(f.error({type:"UnexpectedResult",message:"More than one result has been retrieved"}))})}function y(a){return[A,B][h.userApiVersion()](a)}function z(a,b){b=angular.extend({},b);var d=h.queryParamsV1(b);d.str=a;var e=D()+"/searchByText";return g.paginatedResultSet(c.get(e,{params:d}),i("group",b.factory))}function A(a){var b=h.queryParams(a);return g.paginatedResultSet(c.get(D(),{params:b}))}function B(a){a=angular.extend({},a);var d=h.queryParamsV1(a),e=D();if(a.filter){var j=["name","description"];e+="/search?";for(var k in a.filter){if(a.filter.hasOwnProperty(k)&&-1===j.indexOf(k))return b.reject(f.error({type:"FilterNotSupportedError",message:"Cannot filter on property: "+k}));var l=a.filter[k];angular.isArray(l)?_.each(l,function(a){e+=k+"="+encodeURIComponent(a)+"&"}):e+=k+"="+encodeURIComponent(l)+"&",e=e.slice(0,-1)}}return g.paginatedResultSet(c.get(e,{params:_.omit(d,"filter")}),i("group",a.factory))}function C(){return f.error({type:"UnsupportedMethodException",message:"HBP Identity API must be v1 or higher to create or delete group."})}function D(){return e.get("api.user.v"+h.userApiVersion())+"/group"}var E=d("hbpGroupsCache"),F={get:j,getByName:x,create:r,update:s,"delete":t,getMembers:k,getEpflSyncMembers:l,getMemberGroups:m,getAdmins:n,getAdminGroups:o,getParentGroups:p,getManagedGroups:q,list:y,search:z};return _.each(["members","admins","member-groups","admin-groups"],function(a){var d=function(d,e,f){return e=g.arrayOf(e),b.all(_.map(e,function(b){var e=[D(),d,a,b].join("/");return c({method:f,url:e}).then(function(){return b})}))["catch"](g.ferr)};F[_.camelCase("add-"+a)]=function(b,c){return 0===h.userApiVersion()?u(_.camelCase("add-"+a))(b,g.arrayOf(c)):d(b,c,"POST")},F[_.camelCase("remove-"+a)]=function(b,c){return 0===h.userApiVersion()?u(_.camelCase("remove-"+a))(b,g.arrayOf(c)):d(b,c,"DELETE")}}),F}angular.module("hbpIdentity").factory("hbpIdentityGroupStore",a),a.$inject=["$rootScope","$q","$http","$cacheFactory","bbpConfig","hbpErrorService","hbpUtil","hbpIdentityUtil"]}(),function(){"use strict";function a(a,b){return{resultKey:"_embedded."+a,nextUrlKey:"_links.next.href",previousUrlKey:"_links.prev.href",countKey:"page.totalElements",resultsFactory:b}}function b(b,c,d,e,f,g,h,i,j){function k(a){var b=j.queryParams(a),c=t();a&&a.managedOnly&&(c+="/managed");var e={resultKey:"result"};return i.paginatedResultSet(d.get(c,{params:b}),e)}function l(b){var e=angular.extend({sort:"familyName"},b),f=t();if(e.managedOnly)return c.reject(h.error({type:"OptionNotSupportedError",message:"mangedOnly query not supported yet"}));if(e.filter){var g=["displayName","email","id","username","accountType"];try{f+="/search?"+p(e.filter,g)}catch(k){return c.reject(k)}}var l=a("users",e.factory),m=j.queryParamsV1(e),n=i.paginatedResultSet(d.get(f,{params:m}),l);return 0!==e.pageSize?n:n.then(o)}function m(b,e){angular.isObject(b)&&(e=b,b="me"),b=b||"me",e=angular.extend({sort:"name"},e);var f=j.queryParamsV1(e),g=t()+"/"+b+"/member-groups";if(e.filter)try{g+="?"+p(e.filter,["name"])}catch(h){return c.reject(h)}return i.paginatedResultSet(d.get(g,{params:f}),a("groups",e.factory))}function n(b,e){angular.isObject(b)&&(e=b,b="me"),b=b||"me",e=angular.extend({sort:"name"},e);var f=j.queryParamsV1(e),g=i.format("{0}/{1}/admin-groups",[t(),b]);if(e.filter)try{g+="?"+p(e.filter,["name"])}catch(h){return c.reject(h)}return i.paginatedResultSet(d.get(g,{params:f}),a("groups",e.factory))}function o(a){return a.hasNext?a.next().then(o):a}function p(a,b){if(a){var c="";for(var d in a)if(a.hasOwnProperty(d)){if(-1===b.indexOf(d))throw h.error({type:"FilterNotSupportedError",message:"Cannot filter on property: "+d});var e=a[d];angular.isArray(e)?_.each(e,function(a){c+=d+"="+encodeURIComponent(a)+"&"}):c+=d+"="+encodeURIComponent(e)+"&"}return c.slice(0,-1)}}var q=e("hbpUserCache"),r=g.get("api.user.v0",null),s=g.get("api.user.v1",null),t=function(){var a=[r,s][j.userApiVersion()]+"/user";if(!a)throw h.error({type:"UnkownConfigurationKey",message:"URL for <api.user.v"+j.userApiVersion()+"> is not set"});return a},u=function(){return[r,s][j.userApiVersion()]+"/group"},v="_currentUser_";b.$on("user:disconnected",function(){q.removeAll()});var w=function(a,b,c,d){if(a.length>0){for(var e=b+a[0],f=["%2B","&"+d+"="][j.userApiVersion()],g=1;g<a.length;g++)e.length+a[g].length+f.length<2e3?e+=f+a[g]:(c.push(e),e=b+a[g]);c.push(e)}},x=function(a,b){for(var c=0;c<a.length;c++){var d=a[c];void 0===d.displayName&&(d.displayName=d.name),b[d.id]=d,q.put(d.id,d)}},y=function(a){var b=c.defer(),e=[],g=[],h={},i=[],k=function(){b.reject.apply(b,a)},l=function(a){var c;return a.data.result?c=a.data.result:a.data._embedded.users?c=a.data._embedded.users:a.data._embedded.groups?c=a.data._embedded.groups:a.data.content?c=a.data.content:f.error("Unable to find a resultset in data",a),x(c,h),i&&i.length>0?d.get(i.shift()).then(l,k):void b.resolve(h)};if(_.forEach(a,function(a){var b=q.get(a);b?h[a]=b:"S"===a[0]?g.push(a):e.push(a)}),e.length+g.length===0)b.resolve(h);else{var m=["?filter=id=","/search?id="][j.userApiVersion()],n=["?filter=id=","/search?name="][j.userApiVersion()];w(e,t()+m,i,"id"),w(g,u()+n,i,"value"),d.get(i.shift()).then(l,k)}return b.promise},z=function(a){return this.getCurrentUser().then(function(b){var c=[function(a){return b.groups.indexOf(a)>-1},function(a){return _.some(b.groups,function(b){return b.name===a})}][j.userApiVersion()],d=_.isArray(a)?a:[a];return _.some(d,c)})};return{get:y,getCurrentUserOnly:function(){var a=q.get(v);return a?c.when(a):d.get(t()+"/me").then(function(a){var b=a.data;return q.put(v,b),b},i.ferr)},getCurrentUser:function(){var b=q.get(v);if(b&&b.groups)return c.when(b);var e={};return b||(e.user=this.getCurrentUserOnly()),[function(){e.groups=d.get(t()+"/me/groups").then(function(a){return a.data.result})},function(){e.groups=i.paginatedResultSet(d.get(t()+"/me/member-groups"),a("groups")).then(function(a){return a.toArray()})}][j.userApiVersion()](),c.all(e).then(function(a){var c=a.user||b;return c.groups=a.groups,q.put(v,c),c},i.ferr)},create:function(a){return d.post(t(),a).then(function(){return a},i.ferr)},update:function(a,b){b=b||a;var c="string"==typeof a?a:a.id,e=[d.put,d.patch][j.userApiVersion()];return e(t()+"/"+c,b).then(function(){q.remove(c);var a=q.get(v);return a&&a.id===c&&q.remove(v),y([c]).then(function(a){return _.first(_.values(a))})},i.ferr)},list:function(a){return[k,l][j.userApiVersion()](a)},search:function(b,c){c=angular.extend({},c);var e=j.queryParamsV1(c);e.str=b;var f=t()+"/searchByText";return i.paginatedResultSet(d.get(f,{params:e}),a("users",c.factory))},isAdmin:function(){return this.isGroupMember(g.get("collab.groups.hbpAdmin","S12578"))},isGroupMember:z,isHbpMember:function(){return 0===j.userApiVersion()?c.when(!0):this.isGroupMember(["hbp-accred-sga1"])},adminGroups:n,memberGroups:m}}angular.module("hbpIdentity").factory("hbpIdentityUserDirectory",b),b.$inject=["$rootScope","$q","$http","$cacheFactory","$log","bbpConfig","hbpErrorService","hbpUtil","hbpIdentityUtil"]}(),function(){"use strict";function a(a,b){function c(){return b.get("collab.features.identity.userApiV1",!1)?1:0}function d(a){var b,c={page:0,pageSize:50},d=angular.extend(c,a);if(d.filter){var e=_.map(d.filter,function(a,b){return _.isArray(a)&&(a=a.join("+")),b+"="+a});b=e.join()}var f;return d.sort&&(f=_.isArray(d.sort)?d.sort.join():_(d.sort).toString()),{page:d.page,pageSize:d.pageSize,filter:b,sort:f}}function e(b){var c,d={page:0,pageSize:50},e=angular.extend(d,b);if(e.sort){var f=e.sort;_.isArray(f)&&f.length>0&&(f=f[0],a.warn("Multiple field sorting not supported. Using: "+f)),c=_(f).toString(),"-"===c.charAt(0)&&(c=c.substring(1)+",desc")}return{page:e.page,pageSize:e.pageSize,sort:c}}var f={queryParams:d,queryParamsV1:e,userApiVersion:c};return f}angular.module("hbpIdentity").factory("hbpIdentityUtil",a),a.$inject=["$log","bbpConfig"]}(),angular.module("hbpCommonUI",["ui.bootstrap"]),angular.module("hbpCommon",["hbp-common-templates","ui.router","bbpConfig","bbpOidcClient","hbpUtil","hbpIdentity","hbpCommonUI"]),window.hbpCommonVersion="2.3.0",angular.module("hbpCommon").controller("hbpMetaNavigationCtrl",["$rootScope","$scope","$state","hbpIdentityUserDirectory","bbpOidcSession",function(a,b,c,d,e){"use strict";d.getCurrentUser().then(function(a){b.currentUser=a}),b.logout=function(){e.logout().then(function(){a.$broadcast("user:disconnected"),b.currentUser=null})}}]),angular.module("hbpCommon").directive("hbpBreadcrumb",["$state",function(a){"use strict";return{restrict:"E",templateUrl:"templates/breadcrumb.html",scope:{items:"="},link:function(b){var c=function(b,c){return a.href(b,c)},d=function(){b.parentItems=b.items&&b.items.slice(0,b.items.length-1),b.currentItem=b.items&&b.items[b.items.length-1]},e=function(){b.$watch("items",d),b.urlForState=c,d()};e()}}}]),angular.module("hbpCommon").directive("hbpContentDescription",function(){"use strict";return{templateUrl:"templates/content-description.html",restrict:"E",scope:{content:"=?"},link:function(a){if(a.content){var b=a.content.split("/");b.length>1?a.fallback=b[1]:a.fallback=b[0]}}}}),angular.module("hbpCommon").directive("hbpContentIcon",function(){"use strict";return{templateUrl:"templates/content-icon.html",restrict:"E",scope:{content:"=?"}}}),angular.module("hbpCommon").directive("hbpErrorMessage",function(){return{restrict:"E",scope:{error:"=?hbpError"},templateUrl:"templates/error-message.html"}}),angular.module("hbpCommon").directive("hbpGeneratedIcon",function(){"use strict";return{restrict:"E",scope:{text:"=hbpText",color:"=hbpColor",size:"=?hbpSize"},template:'<canvas width="{{width}}" height="{{height}}" hbp-hires-canvas></canvas>',link:{post:function(a,b){b.addClass("hbp-generated-icon");var c=function(){if(a.text&&a.width&&a.height){var c=b[0].childNodes[0],d=c.width,e=c.height,f=a.text.split(/\s+/,2),g=(""+f[0][0]+(f[1]?f[1][0]:f[0][1])).toUpperCase(),h=a.color;if(!h){var i=["#ee936d","#ea6153","#f8bd93","#308298","#e54639","#4b8f9e","#457493","#456e91"],j=7*g.charCodeAt(0)*13*g.charCodeAt(1)%i.length;h=i[j]}b.attr("style","width:"+a.width+"px; height:"+a.height+"px");var k=b[0].childNodes[0].getContext("2d"),l="Arial",m=176;k.fillStyle=h,k.fillRect(0,0,d,e),k.textAlign="center",k.textBaseline="middle",k.fillStyle="#ffffff";do m-=4,k.font=m+"px "+l;while(m>10&&k.measureText(g).width>.75*d);k.fillText(g,d/2,e/2)}};a.$watch("[text,width,height]",c,!0),a.width=a.size||b[0].offsetWidth,a.height=a.size||b[0].offsetHeight,c()}}}}),angular.module("hbpCommon").directive("hbpHiresCanvas",["hbpHiResService",function(a){"use strict";return{link:{post:function(b,c,d){var e=a.pixelRatio(),f=function(a){return function(b){if(b){var d=b;c.css(a,d+"px").prop(a,d*e)}}};a.isHiResScreen()&&c[0].getContext("2d").transform(e,0,0,e,0,0),d.$observe("width",f("width")),d.$observe("height",f("height"))}}}}]),angular.module("hbpCommon").directive("hbpIcon",function(){"use strict";return{templateUrl:"templates/icon.html",restrict:"E",scope:{entity:"=?",type:"=?"},link:function(a){!a.type&&a.entity&&(a.type=a.entity._entityType)}}}),angular.module("hbpCommonUI").directive("hbpLoading",function(){"use strict";return{restrict:"E",scope:{promise:"=?hbpPromise",message:"=?hbpMessage"},template:'<div class="hbp-loading" ng-if="loading"><span class="glyphicon glyphicon-refresh hbp-spinning"></span> {{message}}</div>',link:function(a){if(a.loading=!0,a.message=a.message||"Loading...",a.promise){var b=function(){a.loading=!1};a.promise.then(b,b)}}}}),angular.module("hbpCommon").directive("hbpOnTouch",["$parse",function(a){"use strict";return{restrict:"A",compile:function(b,c){var d=a(c.hbpOnTouch);return function(a,b){b.on("touchend",function(b){b.preventDefault();var c=function(){d(a,{$event:b})};a.$apply(c)})}}}}]),angular.module("hbpCommonUI").directive("hbpPerformAction",[function(){"use strict";return{restrict:"A",scope:{action:"&hbpPerformAction"},link:function(a,b,c){var d=!1,e=function(){b.html(a.text),b.attr("disabled",!1),b.removeClass("loading"),d=!1},f=function(){d=!0,a.loadingMessage&&b.html(a.loadingMessage),b.addClass("loading"),b.attr("disabled",!0),a.action().then(e,e)};a.loadingMessage=c.hbpLoadingMessage,a.text=a.text||b.html(),b.on("click",f)}}}]),angular.module("hbpCommon").directive("hbpUserSelector",["$q","$http","bbpConfig","hbpUtil","hbpIdentityUserDirectory",function(a,b,c,d,e){"use strict";return{restrict:"EA",scope:{exclude:"=hbpUserExclude",filter:"=?hbpFilter",onUserSelect:"&hbpOnSelect"},templateUrl:function(a,b){return b.hbpTemplate||"templates/userSelector.html"},controller:["$scope",function(b){b.idsToExclude=[],b.$watch("exclude",function(a){a&&a.length>0&&a[0].id?b.idsToExclude=_.map(b.exclude,"id"):a&&(b.idsToExclude=a)}),b.noSubmitOnEnter=function(a){13===a.which&&a.preventDefault()},b.getUsers=function(a){var c=[];return e.list({filter:angular.extend({},b.filter,{displayName:"*"+a+"*"})}).then(function(a){return _.forEach(a.results,function(a){b.idsToExclude.indexOf(a.id)<0&&c.push(a)}),c},d.ferr)},b.selectUser=function(){if(b.onUserSelect){var c=function(){b.selectionDisabled=!1,b.newUser=""},d=b.onUserSelect({user:b.newUser});b.selectionDisabled=!0,a.when(d).then(c,c)}}}]}}]),angular.module("hbpCommon").directive("hbpUsercard",function(){"use strict";return{restrict:"EA",scope:{user:"=hbpUser"},templateUrl:function(a,b){return b.hbpTemplate||"templates/usercard.html"},link:{pre:function(a){a.$watch("user",function(b){a.institution=b&&_.find(b.institutions,"primary"),a.email=b&&_(b.emails).filter("primary").map("value").first(),a.phone=b&&_(b.phones).filter("primary").map("value").first(),a.ims=b&&b.ims})}}}}),angular.module("hbpCommon").filter("hbpDollarToNewLine",function(){"use strict";return function(a){return a&&a.replace(/ \$ /g,"\n")}}),angular.module("hbpCommon").filter("hbpYesNo",function(){"use strict";return function(a){return!a||["0","false","no"].indexOf(a.toString().toLowerCase())>-1?"No":"Yes"}}),angular.module("hbpCommon").service("hbpCollabStore",["$log","$q","$cacheFactory","$http","bbpConfig","hbpIdentityUserDirectory","hbpErrorService","hbpUtil",function(a,b,c,d,e,f,g,h){function i(a){return _.map(a,p.fromJson)}var j=null,k=e.get("api.collab.v0"),l=k+"/collab/",m=k+"/mycollabs/",n=l+"context/",o=c("hbpCollabStoreCollabs"),p=this.Collab=function(a){a||(a={}),this.id=a.id,this.created=a.created||null,this.edited=a.edited||null,this.title=a.title||"",this.content=a.content||"",this["private"]=a["private"]||!1,this.deleted=a.deleted||null};p.prototype={toJson:function(){return{id:this.id,title:this.title,content:this.content,"private":this["private"]}},update:function(a){_.each(["id","title","content","private"],function(b){void 0!==a[b]&&(this[b]=a[b])},this)}},p.fromJson=function(a){if(a.toJson)return a;var b=new p(a);return b};var q=this.Context=function(){};q.fromJson=function(a){var b=new q;return b.context=a.context,b.appId=a.app_id,b.name=a.name,b.navId=a.id,b.collab=p.fromJson(a.collab),b.toJson=function(){return{context:a.context,appId:a.app_id,name:b.name}},b};var r={},s=function(a){var c=o.get(a);return c?b.when(c):r[a]?r[a]:void 0},t=function(a,c){if(!c)return b.reject(g.error({message:"id parameter is required"}));var e=s(c);return e?e:(r[c]=d.get(a+c+"/").then(function(a){return r[c]=null,p.fromJson(a.data)},function(a){return r[c]=null,h.ferr(a)}),r[c])},u=function(a,b){return a._label||(a._label=b,o.put(b,a),o.put(a.id,a)),a};this.get=function(a){return a=a&&a.id||a,t(l,a).then(function(a){return o.put(a.id,a),a})},this.getByLabel=function(a){return t(k+"/r/",a).then(function(b){var c=s(b.id);return c?c.then(function(b){return u(b,a)}):u(b,a)})},this.list=function(a){var b,c=l;return angular.isString(a)&&(c=a,a=arguments[1]),a=angular.extend({},a),angular.isArray(a.id)&&(a.id=a.id.join(",")),a.pageSize&&(a.page_size=a.pageSize),b=a.url?d.get(a.url):d.get(c,{params:angular.extend({},a.params,_.pick(a,["search","id","page_size","page"]))}),h.paginatedResultSet(b,{resultsFactory:i})};var v=function(a){a=angular.extend({},a);var b=angular.extend({},_.pick(a,["search"]));return h.paginatedResultSet(d.get(m,{params:b}),{resultsFactory:i})};this.mine=v,this.create=function(a){var b=p.fromJson(a);return d.post(l,b.toJson()).then(function(a){return b.update(a.data),o.put(b.id,b),b},h.ferr)},this.save=function(a){var b=p.fromJson(a);return d.put(l+b.id+"/",b.toJson()).then(function(a){return b.update(a.data),o.put(b.id,b),b},h.ferr)},this["delete"]=function(a){return d["delete"](l+a.id+"/").then(function(){o.remove(a.id),a._label&&o.remove(a._label)},h.ferr)};var w={};this.context={get:function(a){return a?w[a]?w[a]:(w[a]=d.get(n+a+"/",{cache:!0}).then(function(b){return w[a]=null,q.fromJson(b.data)},function(b){return w[a]=null,h.ferr(b)}),w[a]):b.reject(g.error({message:"uuid parameter is required"}))}};var x={},y=function(a){return b.when(a)};this.team={add:function(a,b){return d.put(l+a+"/team/",{users:[b]}).then(j,h.ferr)},"delete":function(a,b){return d({method:"DELETE",url:l+a+"/team/",data:{users:[b]},headers:{"Content-Type":"application/json"}}).then(j,h.ferr)},list:function(a){return d.get(l+a+"/team/").then(function(b){var c=_.indexBy(b.data,"user_id");return f.list({pageSize:0,filter:{id:_.keys(c)}}).then(function(b){return _.reduce(b.results,function(b,d){var e=c[parseInt(d.id,10)];return e&&(x[a]||(x[a]={}),
x[a][e.user_id]=e.role,b.push(angular.extend({},d,{membershipId:e.user_id,role:e.role}))),b},[])})},h.ferr)},userInTeam:function(a){return f.getCurrentUserOnly().then(function(b){return d.get(l+a+"/team/").then(function(a){return void 0!==_.indexBy(a.data,"user_id")[parseInt(b.id,10)]})})},roles:{get:function(b,c){return c?(x[b]||(x[b]={}),x[b]&&x[b][c]?y(x[b][c]):d.get(l+b+"/team/role/"+c+"/").then(function(a){return x[b][c]=a.data.role,y(x[b][c])},function(a){return 404===a.status?(x[b][c]=void 0,y(x[b][c])):void h.ferr(a)})):void a.debug("Must provide userId: ",b,c)},set:function(a,b,c){var e=l+a+"/team/role/"+b+"/";return x[a]&&x[a][b]?(x[a][b]=c,d.put(e,{role:c}).then(j,function(a){return 404===a.status?d.post(e,{role:c}).then(j,h.ferr):h.ferr(a)})):(x[a]||(x[a]={}),x[a][b]=c,d.post(e,{role:c}).then(j,h.ferr))}}}}]),angular.module("hbpCommon").service("hbpConfigStore",["$http","bbpConfig","hbpUtil",function(a,b,c){var d=b.get("api.collab.v0")+"/config/";this.get=function(b){return a.get(d+b+"/").then(function(a){return a.data},c.ferr)},this.list=function(a){return c.getList(d,a)()},this.create=function(b){return a.post(d,b).then(function(a){return a.data},c.ferr)},this.save=function(b){return a.put(d+b.context+"/",b).then(function(a){return a.data},c.ferr)},this["delete"]=function(b){a["delete"](d+b.context+"/").then(null,c.ferr)}}]),angular.module("hbpCommon").factory("hbpDialogFactory",["$modal","$log","$q","$rootScope","$compile","$templateCache","hbpErrorService",function(a,b,c,d,e,f,g){"use strict";function h(b){b=_.extend({scope:d,title:"Confirm",confirmLabel:"Yes",cancelLabel:"No",template:"Are you sure?",closable:!0},b);var c=b.scope.$new();c.title=b.title,c.confirmLabel=b.confirmLabel,c.cancelLabel=b.cancelLabel,c.confirmationContent=b.template,c.confirmationContentUrl=b.templateUrl,c.closable=b.closable,c.securityQuestion=b.securityQuestion,c.securityAnswer=b.securityAnswer;var e=a.open({templateUrl:"templates/dialog-confirmation.html",show:!0,backdrop:"static",scope:c,keyboard:b.keyboard||b.closable});return e.result}function i(a){var b=d.$new();return b.error=a,j({"class":"error",title:"Error!",label:"Close",scope:b,templateUrl:"templates/error-alert.html"})}function j(b){if("string"==typeof b)return k.apply(window,arguments);b=_.extend({scope:d,title:"Message",label:"Close","class":"default"},b);var c=b.scope.$new();c.title=b.title,c.label=b.label,c.alertContentUrl=b.templateUrl,c.alertContent=b.template,c.htmlClass=b["class"];var e=a.open({templateUrl:"templates/dialog-alert.html",show:!0,backdrop:"static",scope:c});return e.result}function k(a,c,d){return b.warn("hbpDialogFactory.alert(templateUrl, title, scope) is deprecated."),b.log("Use hbpDialogFactory.alert(options) instead"),j({templateUrl:a,title:c,scope:d})}return{alert:j,error:i,confirm:h,confirmation:function(a,d,e,f,i){return b.warn("hbpDialogFactory.confirmation is deprecated."),b.log("Use hbpDialogFactory.confirm instead"),h({scope:i,title:e,confirmLabel:f,cancelLabel:"cancel",templateUrl:a}).then(function(){return d?d(i).then(null,function(a){var b;return"string"==typeof a?b=g.error({type:"Error",message:a}):a?(a.status||(a={status:-1,data:a}),b=g.httpError(a)):b=g.error(),j({title:"Error","class":"alert-danger",template:b.message}),c.reject(b)}):void 0})}}}]),angular.module("hbpCommon").service("hbpErrorService",function(){"use strict";var a=function(a){a=angular.extend({type:"UnknownError",message:"An unknown error occurred.",code:-1},a),this.type=a.type,this.name=this.type,this.message=a.message,this.data=a.data,this.code=a.code,this.stack=(new Error).stack};return a.prototype=Object.create(Error.prototype),a.prototype.toString=function(){return""+this.type+":"+this.message},{httpError:function(b){if(b&&b instanceof a)return b;if(void 0===b.status)return new a({message:"Cannot parse error, invalid format."});var c=new a({code:b.status});if(0===c.code)return c.type="ClientError",c.message="The client cannot run the request.",c;if(404===c.code)return c.type="NotFound",c.message="Resource not found",c;if(403===c.code)return c.type="Forbidden",c.message="Permission denied: you are not allowed to display the page or perform the operation",c;if(502===c.code){if(c.type="BadGateway",c.message="502 Bad Gateway Error","text/html"===b.headers("content-type")){var d=document.createElement("div");d.innerHTML=b.data;var e=d.getElementsByTagName("title")[0];e&&(c.message=e.innerHTML)}return c}if(b.data){var f=b.data;f.error&&(f=f.error),f.type&&(c.type=f.type),f.data&&(c.data=f.data),f.message?c.message=f.message:f.reason&&(c.type="Error",c.message=f.reason),f.type||f.data||f.message||f.reason||(c.data=f)}return c},error:function(b){return b&&b instanceof a?b:new a(b)}}}),angular.module("hbpCommon").service("hbpHiResService",function(){"use strict";return{isHiResScreen:function(){return"devicePixelRatio"in window&&window.devicePixelRatio>1||"matchMedia"in window&&window.matchMedia("(min-resolution:144dpi)").matches},pixelRatio:function(){return window.devicePixelRatio||1}}}),angular.module("hbpCommon").service("hbpUiUtil",["$window","$document","$q","hbpErrorService",function(a,b,c,d){"use strict";function e(c){c.find&&(c=c[0]);var d=c.getBoundingClientRect();return d.top>=0&&d.left>=0&&d.bottom<=(a.innerHeight||b.documentElement.clientHeight)&&d.right<=(a.innerWidth||b.documentElement.clientWidth)}var f=function(a,b){return function(e){var f=Array.prototype.slice.call(arguments);return f.shift(),a.apply(this,f).then(function(a){e(a)},function(a){b.error=d.httpError(a),c.reject(b.error)})}};return{isInViewport:e,dialogSubmissionRestCallErrorHandler:f}}]).filter("hbpDatetime",["$filter",function(a){"use strict";return function(b){return a("date")(b,"yyyy-MM-dd HH:mm:ss")}}]).filter("hbpCapitalize",[function(){"use strict";return function(a){return a.charAt().toUpperCase()+a.substring(1)}}]).filter("hbpMarkdown",["$sce",function(a){"use strict";return function(b){return void 0!==b?a.trustAsHtml(marked(b,{sanitize:!0})):void 0}}]).run(["$rootScope","$log","$state","$stateParams","$location","$window",function(a,b,c,d,e,f){"use strict";var g=0;a.$on("$stateChangeSuccess",function(a,b,c,d){d&&d.name&&!e.$$replace&&g++}),a.goToPrevious=function(a,d){g>0?(g--,f.history.go(-1)):a?c.go(a,d):b.error("no previous state, cannot navigate back.")}}]),angular.module("hbpCommon").config(["$httpProvider",function(a){"use strict";window.XMLHttpRequest=function(a){return function(){var b=new a;return b.setRequestHeader=function(a){return function(c,d){"HBP-AngularProgressEventMixin"===c?d.call(b,b):a.apply(this,arguments)}}(b.setRequestHeader),b}}(window.XMLHttpRequest),a.interceptors.push("hbpXhrProgressEventInterceptor")}]).factory("hbpXhrProgressEventInterceptor",function(){"use strict";return{request:function(a){return(a.uploadProgress||a.progress)&&(a.headers["HBP-AngularProgressEventMixin"]=function(b){a.uploadProgress&&b.upload.addEventListener("progress",a.uploadProgress,!1),a.progress&&b.addEventListener("progress",a.progress,!1)}),a}}});